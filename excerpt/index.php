<?php

namespace _\lot\x {
    function excerpt($content) {
        // `excerpt` data has been set
        if ($content) {
            return $content; // Return the initial value
        }
        $cut = \state('excerpt')['cut'] ?? null;
        // Excerpt cropper does not exist, return the page’s `description`
        $content = $this->content;
        if (!$content || !$cut || \strpos($content, $cut) === false) {
            // If page’s `description` is empty, create a fake excerpt generated by the page’s `content`
            return $this->description ?? \To::excerpt((string) $content);
        }
        // Return the first part!
        return \trim(\explode($cut, $content)[0]);
    }
    \Hook::set('page.excerpt', __NAMESPACE__ . "\\excerpt", 2.1);
}

namespace _\lot\x\excerpt {
    function anchor($content) {
        extract(\state('excerpt'), \EXTR_SKIP);
        if (empty($cut) || \Config::is('pages') || \strpos($content, $cut) === false) {
            return $content;
        }
        return \implode('<div class="fi" id="' . \sprintf($anchor, $this->id) . '"></div>', \explode($cut, $content, 2));
    }
    \Hook::set('page.content', __NAMESPACE__ . "\\anchor", 2.1);
}